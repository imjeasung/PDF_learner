<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•™ìŠµí•˜ê¸° - PDF Learner</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* í•™ìŠµ í˜ì´ì§€ ì „ìš© ìŠ¤íƒ€ì¼ */
        .study-container {
            display: grid;
            grid-template-columns: 300px 1fr;
            height: calc(100vh - 80px);
            gap: 0;
            max-width: 100%;
            margin: 0;
            padding: 0;
        }
        
        .sidebar {
            background: #f8f9fa;
            border-right: 1px solid #e9ecef;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }
        
        .main-content {
            display: flex;
            overflow: hidden;
            position: relative;
        }
        
        .content-area {
            background: white;
            overflow-y: auto;
            padding: 2rem;
            flex: 1;
            min-width: 300px;
        }
        
        .chat-area {
            background: #f8f9fa;
            display: flex;
            flex-direction: column;
            padding: 1rem;
            width: 450px;
            min-width: 300px;
            max-width: 700px;
        }
        
        .resizer {
            width: 8px;
            background: linear-gradient(90deg, #e9ecef 0%, #bdc3c7 50%, #e9ecef 100%);
            cursor: col-resize;
            position: relative;
            transition: background 0.2s ease;
            flex-shrink: 0;
        }
        
        .resizer:hover {
            background: linear-gradient(90deg, #3498db 0%, #2980b9 50%, #3498db 100%);
        }
        
        .resizer::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 3px;
            height: 30px;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 2px;
        }
        
        .resizer:hover::before {
            background: rgba(255, 255, 255, 0.9);
        }
        
        /* ë¬¸ì„œ ì„ íƒ ì˜ì—­ */
        .document-selector {
            padding: 1rem;
            border-bottom: 1px solid #e9ecef;
            background: white;
        }
        
        .document-selector h3 {
            font-size: 1.1rem;
            margin-bottom: 1rem;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .document-select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 0.9rem;
            background: white;
        }
        
        .document-info {
            margin-top: 0.75rem;
            padding: 0.75rem;
            background: #f8f9fa;
            border-radius: 6px;
            font-size: 0.85rem;
            color: #7f8c8d;
        }
        
        /* ì»¤ë¦¬í˜ëŸ¼ íŠ¸ë¦¬ */
        .curriculum-tree {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
        }
        
        .curriculum-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .curriculum-header h4 {
            font-size: 1rem;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .tree-item {
            margin-bottom: 0.5rem;
        }
        
        .tree-node {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.9rem;
        }
        
        .tree-node:hover {
            background: #f8f9fa;
            border-color: #3498db;
        }
        
        .tree-node.active {
            background: linear-gradient(45deg, #3498db, #2ecc71);
            color: white;
            border-color: #3498db;
        }
        
        .tree-node.active:hover {
            background: linear-gradient(45deg, #2980b9, #27ae60);
        }
        
        .tree-icon {
            margin-right: 0.5rem;
            width: 16px;
            text-align: center;
        }
        
        .tree-text {
            flex: 1;
            line-height: 1.4;
        }
        
        .tree-progress {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #ecf0f1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            margin-left: 0.5rem;
        }
        
        .tree-progress.completed {
            background: #2ecc71;
            color: white;
        }
        
        .tree-progress.current {
            background: #3498db;
            color: white;
        }
        
        /* ì½˜í…ì¸  ì˜ì—­ */
        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #ecf0f1;
        }
        
        .content-title {
            font-size: 2rem;
            color: #2c3e50;
            margin: 0;
        }
        
        .content-actions {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }
        
        .content-actions .btn {
            white-space: nowrap;
            font-weight: 500;
            background: #3498db !important;
            color: white !important;
            border: 2px solid #2980b9 !important;
            padding: 0.5rem 1rem !important;
            border-radius: 6px !important;
            font-size: 0.9rem !important;
            transition: all 0.3s ease !important;
            box-shadow: 0 2px 4px rgba(52, 152, 219, 0.3) !important;
            z-index: 10;
            position: relative;
        }
        
        .content-actions .btn:hover {
            background: #2980b9 !important;
            transform: translateY(-1px) !important;
            box-shadow: 0 4px 8px rgba(52, 152, 219, 0.4) !important;
        }
        
        .section-content {
            display: none;
        }
        
        .section-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .content-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border-left: 4px solid #3498db;
        }
        
        .content-card h4 {
            font-size: 1.2rem;
            color: #2c3e50;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .summary-text {
            font-size: 1.1rem;
            line-height: 1.6;
            color: #2c3e50;
        }
        
        .keywords {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        
        .keyword-tag {
            background: linear-gradient(45deg, #3498db, #2ecc71);
            color: white;
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .questions-list {
            list-style: none;
            padding: 0;
        }
        
        .questions-list li {
            background: white;
            padding: 1rem;
            margin-bottom: 0.75rem;
            border-radius: 6px;
            border-left: 3px solid #3498db;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .questions-list li:hover {
            background: #f8f9fa;
            transform: translateX(5px);
        }
        
        .question-number {
            font-weight: bold;
            color: #3498db;
            margin-right: 0.5rem;
        }
        
        /* ì±„íŒ… ì˜ì—­ */
        .chat-header {
            display: flex;
            justify-content: between;
            align-items: center;
            padding: 1rem;
            background: white;
            border-radius: 8px 8px 0 0;
            border-bottom: 1px solid #e9ecef;
        }
        
        .chat-header h4 {
            font-size: 1.1rem;
            color: #2c3e50;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .chat-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            color: #7f8c8d;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #2ecc71;
            animation: pulse 2s infinite;
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            background: white;
        }
        
        .message {
            margin-bottom: 1rem;
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
        }
        
        .message.user {
            flex-direction: row-reverse;
        }
        
        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            flex-shrink: 0;
        }
        
        .message.user .message-avatar {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }
        
        .message.ai .message-avatar {
            background: linear-gradient(45deg, #3498db, #2ecc71);
            color: white;
        }
        
        .message-content {
            max-width: 80%;
            padding: 0.75rem 1rem;
            border-radius: 12px;
            line-height: 1.5;
            font-size: 0.9rem;
        }
        
        .message.user .message-content {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border-radius: 12px 12px 4px 12px;
        }
        
        .message.ai .message-content {
            background: #f8f9fa;
            color: #2c3e50;
            border: 1px solid #e9ecef;
            border-radius: 12px 12px 12px 4px;
        }
        
        .message-time {
            font-size: 0.7rem;
            color: rgba(255,255,255,0.8);
            margin-top: 0.25rem;
        }
        
        .message.ai .message-time {
            color: #7f8c8d;
        }
        
        .chat-input-area {
            padding: 1rem;
            background: white;
            border-radius: 0 0 8px 8px;
            border-top: 1px solid #e9ecef;
        }
        
        .chat-input-group {
            display: flex;
            gap: 0.5rem;
            align-items: flex-end;
        }
        
        .chat-input {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 20px;
            font-size: 0.9rem;
            resize: none;
            max-height: 100px;
            min-height: 40px;
        }
        
        .chat-input:focus {
            outline: none;
            border-color: #3498db;
        }
        
        .chat-send-btn {
            width: 40px;
            height: 40px;
            border: none;
            background: linear-gradient(45deg, #3498db, #2ecc71);
            color: white;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        
        .chat-send-btn:hover {
            transform: scale(1.1);
        }
        
        .chat-send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        /* ë¹ˆ ìƒíƒœ */
        .empty-content {
            text-align: center;
            padding: 3rem;
            color: #7f8c8d;
        }
        
        .empty-content i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }
        
        .loading-state {
            text-align: center;
            padding: 2rem;
            color: #7f8c8d;
        }
        
        .loading-state i {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: #3498db;
        }
        
        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 1024px) {
            .study-container {
                grid-template-columns: 280px 1fr;
            }
            
            .main-content {
                grid-template-rows: 1fr 350px;
            }
        }
        
        @media (max-width: 768px) {
            .study-container {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr;
                height: auto;
                min-height: calc(100vh - 80px);
            }
            
            .sidebar {
                height: auto;
                max-height: 300px;
                border-right: none;
                border-bottom: 1px solid #e9ecef;
            }
            
            .main-content {
                flex-direction: column;
                min-height: 500px;
            }
            
            .content-area {
                width: 100% !important;
                flex: 1 !important;
                border-right: none;
                border-bottom: 1px solid #e9ecef;
            }
            
            .chat-area {
                width: 100% !important;
                flex: none !important;
            }
            
            .resizer {
                display: none;
            }
            
            .chat-area {
                height: 400px;
            }
            
            .content-area {
                padding: 1rem;
            }
            
            .content-title {
                font-size: 1.5rem;
            }
            
            .content-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
            
            .content-actions {
                width: 100%;
                justify-content: flex-start;
            }
        }
        
        /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ë§ */
        .sidebar::-webkit-scrollbar,
        .content-area::-webkit-scrollbar,
        .chat-messages::-webkit-scrollbar {
            width: 6px;
        }
        
        .sidebar::-webkit-scrollbar-track,
        .content-area::-webkit-scrollbar-track,
        .chat-messages::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        
        .sidebar::-webkit-scrollbar-thumb,
        .content-area::-webkit-scrollbar-thumb,
        .chat-messages::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }
        
        .sidebar::-webkit-scrollbar-thumb:hover,
        .content-area::-webkit-scrollbar-thumb:hover,
        .chat-messages::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
    </style>
</head>
<body>
    <!-- í—¤ë” -->
    <header class="header">
        <div class="container">
            <div class="logo">
                <i class="fas fa-book-reader"></i>
                <h1>PDF Learner</h1>
            </div>
            <nav class="nav">
                <a href="index.html" class="nav-link">í™ˆ</a>
                <a href="upload.html" class="nav-link">ì—…ë¡œë“œ</a>
                <a href="study.html" class="nav-link active">í•™ìŠµ</a>
            </nav>
        </div>
    </header>

    <!-- ë©”ì¸ í•™ìŠµ ì¸í„°í˜ì´ìŠ¤ -->
    <div class="study-container">
        <!-- ì‚¬ì´ë“œë°” -->
        <div class="sidebar">
            <!-- ë¬¸ì„œ ì„ íƒ -->
            <div class="document-selector">
                <h3><i class="fas fa-file-pdf"></i> ë¬¸ì„œ ì„ íƒ</h3>
                <select class="document-select" id="document-select">
                    <option value="">ë¬¸ì„œë¥¼ ì„ íƒí•˜ì„¸ìš”...</option>
                </select>
                <div class="document-info" id="document-info" style="display: none;">
                    <div><strong>í˜ì´ì§€:</strong> <span id="doc-pages">-</span></div>
                    <div><strong>í¬ê¸°:</strong> <span id="doc-size">-</span></div>
                    <div><strong>ìƒíƒœ:</strong> <span id="doc-status">-</span></div>
                </div>
            </div>
            
            <!-- ì»¤ë¦¬í˜ëŸ¼ íŠ¸ë¦¬ -->
            <div class="curriculum-tree">
                <div class="curriculum-header">
                    <h4><i class="fas fa-list"></i> í•™ìŠµ ì»¤ë¦¬í˜ëŸ¼</h4>
                </div>
                <div id="curriculum-tree-content">
                    <div class="empty-content">
                        <i class="fas fa-book-open"></i>
                        <p>ë¬¸ì„œë¥¼ ì„ íƒí•˜ë©´<br>ì»¤ë¦¬í˜ëŸ¼ì´ í‘œì‹œë©ë‹ˆë‹¤</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ë©”ì¸ ì½˜í…ì¸  -->
        <div class="main-content">
            <!-- ì½˜í…ì¸  ì˜ì—­ -->
            <div class="content-area">
                <div id="content-welcome" class="section-content active">
                    <div class="content-header">
                        <h2 class="content-title">ğŸ“š AI í•™ìŠµ ë„ìš°ë¯¸</h2>
                    </div>
                    
                    <div class="empty-content">
                        <i class="fas fa-graduation-cap"></i>
                        <h3>í•™ìŠµì„ ì‹œì‘í•´ë³´ì„¸ìš”!</h3>
                        <p>ì™¼ìª½ì—ì„œ ë¬¸ì„œë¥¼ ì„ íƒí•˜ê³  ì»¤ë¦¬í˜ëŸ¼ì˜ ì„¹ì…˜ì„ í´ë¦­í•˜ë©´<br>AIê°€ ìƒì„±í•œ ìš”ì•½ê³¼ í•µì‹¬ ë‚´ìš©ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                        <p>ì•„ë˜ ì±„íŒ…ì°½ì—ì„œ ë¬¸ì„œì— ëŒ€í•œ ì§ˆë¬¸ë„ í•  ìˆ˜ ìˆì–´ìš”!</p>
                    </div>
                </div>
                
                <div id="content-loading" class="section-content">
                    <div class="loading-state">
                        <i class="fas fa-spinner fa-spin"></i>
                        <h3>ì½˜í…ì¸ ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</h3>
                        <p>AIê°€ ë¶„ì„í•œ ë‚´ìš©ì„ ì¤€ë¹„í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p>
                    </div>
                </div>
                
                <div id="content-section" class="section-content">
                    <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë  ì„¹ì…˜ ë‚´ìš© -->
                </div>
            </div>
            
            <!-- í¬ê¸° ì¡°ì ˆ ë°” -->
            <div class="resizer" id="resizer"></div>
            
            <!-- ì±„íŒ… ì˜ì—­ -->
            <div class="chat-area">
                <div class="chat-header">
                    <h4><i class="fas fa-robot"></i> AI í•™ìŠµ ë„ìš°ë¯¸</h4>
                    <div class="chat-status">
                        <span class="status-dot"></span>
                        <span>ì˜¨ë¼ì¸</span>
                    </div>
                </div>
                
                <div class="chat-messages" id="chat-messages">
                    <div class="message ai">
                        <div class="message-avatar">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div class="message-content">
                            ì•ˆë…•í•˜ì„¸ìš”! ì €ëŠ” PDF Learnerì˜ AI í•™ìŠµ ë„ìš°ë¯¸ì…ë‹ˆë‹¤. ğŸ“š<br>
                            ë¬¸ì„œì— ëŒ€í•´ ê¶ê¸ˆí•œ ì ì´ ìˆìœ¼ë©´ ì–¸ì œë“  ì§ˆë¬¸í•´ì£¼ì„¸ìš”!
                            <div class="message-time" id="welcome-time"></div>
                        </div>
                    </div>
                </div>
                
                <div class="chat-input-area">
                    <div class="chat-input-group">
                        <textarea 
                            class="chat-input" 
                            id="chat-input" 
                            placeholder="ë¬¸ì„œì— ëŒ€í•´ ì§ˆë¬¸í•´ë³´ì„¸ìš”..."
                            rows="1"></textarea>
                        <button class="chat-send-btn" id="chat-send-btn" disabled>
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="js/script.js"></script>
    <script>
        // í•™ìŠµ í˜ì´ì§€ ì „ìš© ë³€ìˆ˜
        let currentDocument = null;
        let currentCurriculum = null;
        let currentSection = null;
        let chatHistory = [];
        let isTyping = false;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            initStudyPage();
            setupChatEvents();
            initResizer();
            
            // URL íŒŒë¼ë¯¸í„°ì—ì„œ íŒŒì¼ëª… í™•ì¸
            const urlParams = new URLSearchParams(window.location.search);
            const selectedFile = urlParams.get('file');
            if (selectedFile) {
                setTimeout(() => selectDocumentByName(selectedFile), 1000);
            }
        });

        // í•™ìŠµ í˜ì´ì§€ ì´ˆê¸°í™”
        async function initStudyPage() {
            try {
                await loadDocumentList();
                setWelcomeTime();
            } catch (error) {
                console.error('Study page initialization failed:', error);
                showMessage('í˜ì´ì§€ ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ë¬¸ì„œ ëª©ë¡ ë¡œë“œ
        async function loadDocumentList() {
            try {
                const data = await fetchDocuments();
                const select = document.getElementById('document-select');
                
                // ê¸°ì¡´ ì˜µì…˜ ì œê±° (ì²« ë²ˆì§¸ ì œì™¸)
                while (select.children.length > 1) {
                    select.removeChild(select.lastChild);
                }
                
                // ì²˜ë¦¬ ì™„ë£Œëœ ë¬¸ì„œë§Œ í‘œì‹œ
                const processedDocs = data.files.filter(file => 
                    file.status === 'completed' || !file.status
                );
                
                if (processedDocs.length === 0) {
                    const option = document.createElement('option');
                    option.value = '';
                    option.textContent = 'í•™ìŠµ ê°€ëŠ¥í•œ ë¬¸ì„œê°€ ì—†ìŠµë‹ˆë‹¤';
                    option.disabled = true;
                    select.appendChild(option);
                    return;
                }
                
                processedDocs.forEach(file => {
                    const option = document.createElement('option');
                    option.value = file.filename;
                    option.textContent = file.filename;
                    select.appendChild(option);
                });
                
                // ë¬¸ì„œ ì„ íƒ ì´ë²¤íŠ¸ ë“±ë¡
                select.addEventListener('change', handleDocumentSelection);
                
            } catch (error) {
                console.error('Failed to load document list:', error);
                showMessage('ë¬¸ì„œ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // URL íŒŒë¼ë¯¸í„°ë¡œ ë¬¸ì„œ ì„ íƒ
        function selectDocumentByName(filename) {
            const select = document.getElementById('document-select');
            const decodedFilename = decodeURIComponent(filename);
            
            // ì„ íƒ ëª©ë¡ì—ì„œ í•´ë‹¹ íŒŒì¼ ì°¾ê¸°
            for (let option of select.options) {
                if (option.value === decodedFilename) {
                    select.value = decodedFilename;
                    handleDocumentSelection();
                    break;
                }
            }
        }

        // ë¬¸ì„œ ì„ íƒ ì²˜ë¦¬
        async function handleDocumentSelection() {
            const select = document.getElementById('document-select');
            const filename = select.value;
            
            if (!filename) {
                resetStudyInterface();
                return;
            }
            
            try {
                await loadDocumentData(filename);
                updateDocumentInfo();
                await loadCurriculum(filename);
                enableChat();
                
                showMessage('ë¬¸ì„œê°€ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤. í•™ìŠµì„ ì‹œì‘í•˜ì„¸ìš”!', 'success');
                
            } catch (error) {
                console.error('Document selection failed:', error);
                showMessage('ë¬¸ì„œë¥¼ ë¡œë“œí•˜ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                resetStudyInterface();
            }
        }

        // ë¬¸ì„œ ë°ì´í„° ë¡œë“œ
        async function loadDocumentData(filename) {
            // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” API í˜¸ì¶œ
            // const data = await apiCall(`/document/${encodeURIComponent(filename)}`);
            
            // í˜„ì¬ëŠ” ë”ë¯¸ ë°ì´í„°
            currentDocument = {
                filename: filename,
                pages: Math.floor(Math.random() * 50) + 10,
                size_mb: (Math.random() * 10 + 1).toFixed(1),
                status: 'completed'
            };
        }

        // ë¬¸ì„œ ì •ë³´ ì—…ë°ì´íŠ¸
        function updateDocumentInfo() {
            if (!currentDocument) return;
            
            document.getElementById('doc-pages').textContent = currentDocument.pages + 'í˜ì´ì§€';
            document.getElementById('doc-size').textContent = currentDocument.size_mb + ' MB';
            document.getElementById('doc-status').textContent = 'ë¶„ì„ ì™„ë£Œ';
            document.getElementById('document-info').style.display = 'block';
        }

        // ì»¤ë¦¬í˜ëŸ¼ ë¡œë“œ
        async function loadCurriculum(filename) {
            try {
                // API í˜¸ì¶œ (ë°°í¬í™˜ê²½ ëŒ€ì‘)
                const response = await fetch(`/curriculum/${encodeURIComponent(filename)}`);
                
                if (!response.ok) {
                    throw new Error(`ì»¤ë¦¬í˜ëŸ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${response.status}`);
                }
                
                currentCurriculum = await response.json();
                renderCurriculumTree();
                
            } catch (error) {
                console.error('Failed to load curriculum:', error);
                showCurriculumError();
            }
        }

        // ë”ë¯¸ ì»¤ë¦¬í˜ëŸ¼ ìƒì„± (ì‹¤ì œë¡œëŠ” APIì—ì„œ ë°›ì•„ì˜´)
        function generateDummyCurriculum() {
            return {
                sections: [
                    {
                        id: 'section1',
                        title: 'ê°œìš” ë° ì†Œê°œ',
                        summary: 'ì´ ë¬¸ì„œì˜ ì „ë°˜ì ì¸ ê°œìš”ì™€ ì£¼ìš” ëª©ì ì„ ì„¤ëª…í•˜ëŠ” ì„¹ì…˜ì…ë‹ˆë‹¤.',
                        keywords: ['ê°œìš”', 'ì†Œê°œ', 'ëª©ì ', 'ë°°ê²½', 'ë²”ìœ„'],
                        questions: [
                            'ì´ ë¬¸ì„œì˜ ì£¼ìš” ëª©ì ì€ ë¬´ì—‡ì¸ê°€ìš”?',
                            'ë‹¤ë£¨ëŠ” ì£¼ì œì˜ ë²”ìœ„ëŠ” ì–´ë–»ê²Œ ë˜ë‚˜ìš”?',
                            'ë…ìê°€ ì•Œì•„ì•¼ í•  ë°°ê²½ì§€ì‹ì€ ë¬´ì—‡ì¸ê°€ìš”?'
                        ]
                    },
                    {
                        id: 'section2', 
                        title: 'í•µì‹¬ ê°œë…',
                        summary: 'ë¬¸ì„œì—ì„œ ë‹¤ë£¨ëŠ” í•µì‹¬ ê°œë…ë“¤ê³¼ ê¸°ë³¸ ì›ë¦¬ë¥¼ ì„¤ëª…í•©ë‹ˆë‹¤.',
                        keywords: ['í•µì‹¬ê°œë…', 'ì›ë¦¬', 'ê¸°ì´ˆ', 'ì´ë¡ ', 'ì •ì˜'],
                        questions: [
                            'ê°€ì¥ ì¤‘ìš”í•œ í•µì‹¬ ê°œë…ì€ ë¬´ì—‡ì¸ê°€ìš”?',
                            'ì´ ê°œë…ë“¤ì€ ì–´ë–»ê²Œ ì„œë¡œ ì—°ê´€ë˜ì–´ ìˆë‚˜ìš”?',
                            'ì‹¤ì œ ì ìš© ì‚¬ë¡€ëŠ” ì–´ë–¤ ê²ƒë“¤ì´ ìˆë‚˜ìš”?'
                        ]
                    },
                    {
                        id: 'section3',
                        title: 'ì‹¤ë¬´ ì ìš©',
                        summary: 'ì´ë¡ ì  ë‚´ìš©ì„ ì‹¤ì œ ì—…ë¬´ë‚˜ ìƒí™©ì— ì ìš©í•˜ëŠ” ë°©ë²•ì„ ë‹¤ë£¹ë‹ˆë‹¤.',
                        keywords: ['ì‹¤ë¬´', 'ì ìš©', 'ì‘ìš©', 'ì‹¤ìŠµ', 'ì‚¬ë¡€'],
                        questions: [
                            'ì‹¤ë¬´ì—ì„œ ì–´ë–»ê²Œ í™œìš©í•  ìˆ˜ ìˆë‚˜ìš”?',
                            'ì£¼ì˜í•´ì•¼ í•  ì ì€ ë¬´ì—‡ì¸ê°€ìš”?',
                            'ì„±ê³µì ì¸ ì ìš© ì‚¬ë¡€ëŠ” ì–´ë–¤ ê²ƒë“¤ì´ ìˆë‚˜ìš”?'
                        ]
                    },
                    {
                        id: 'section4',
                        title: 'ê²°ë¡  ë° ìš”ì•½',
                        summary: 'ë¬¸ì„œì˜ ì£¼ìš” ë‚´ìš©ì„ ì •ë¦¬í•˜ê³  ê²°ë¡ ì„ ì œì‹œí•©ë‹ˆë‹¤.',
                        keywords: ['ê²°ë¡ ', 'ìš”ì•½', 'ì •ë¦¬', 'ì‹œì‚¬ì ', 'í–¥í›„ê³¼ì œ'],
                        questions: [
                            'ì´ ë¬¸ì„œì˜ í•µì‹¬ ë©”ì‹œì§€ëŠ” ë¬´ì—‡ì¸ê°€ìš”?',
                            'í–¥í›„ ì–´ë–¤ ë°œì „ ë°©í–¥ì´ ì œì‹œë˜ë‚˜ìš”?',
                            'ë…ìê°€ ì·¨í•´ì•¼ í•  í–‰ë™ì€ ë¬´ì—‡ì¸ê°€ìš”?'
                        ]
                    }
                ]
            };
        }

        // ì»¤ë¦¬í˜ëŸ¼ íŠ¸ë¦¬ ë Œë”ë§
        function renderCurriculumTree() {
            const container = document.getElementById('curriculum-tree-content');
            
            if (!currentCurriculum || !currentCurriculum.structure) {
                container.innerHTML = `
                    <div class="empty-content">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>ì»¤ë¦¬í˜ëŸ¼ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</p>
                    </div>
                `;
                return;
            }
            
            const treeHtml = currentCurriculum.structure.map((section, index) => `
                <div class="tree-item">
                    <div class="tree-node" onclick="selectSection('${section.section_id}')">
                        <i class="fas fa-book tree-icon"></i>
                        <div class="tree-text">${section.title}</div>
                        <div class="tree-progress" id="progress-${section.section_id}">
                            ${index + 1}
                        </div>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = treeHtml;
        }

        // ì„¹ì…˜ ì„ íƒ
        function selectSection(sectionId) {
            if (!currentCurriculum) return;
            
            const section = currentCurriculum.structure.find(s => s.section_id === sectionId);
            const sectionContent = currentCurriculum.content[sectionId];
            if (!section || !sectionContent) return;
            
            currentSection = section;
            
            // íŠ¸ë¦¬ì—ì„œ í™œì„± ìƒíƒœ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.tree-node').forEach(node => {
                node.classList.remove('active');
            });
            
            const selectedNode = document.querySelector(`[onclick="selectSection('${sectionId}')"]`);
            if (selectedNode) {
                selectedNode.classList.add('active');
            }
            
            // ì§„í–‰ ìƒíƒœ ì—…ë°ì´íŠ¸
            const progressEl = document.getElementById(`progress-${sectionId}`);
            if (progressEl) {
                progressEl.classList.add('current');
                progressEl.innerHTML = '<i class="fas fa-eye"></i>';
            }
            
            // ì½˜í…ì¸  í‘œì‹œ
            showSectionContent(section, sectionContent);
        }

        // ì„¹ì…˜ ì½˜í…ì¸  í‘œì‹œ
        function showSectionContent(section, sectionContent) {
            // ëª¨ë“  ì„¹ì…˜ ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.section-content').forEach(el => {
                el.classList.remove('active');
            });
            
            // ë¡œë”© í‘œì‹œ
            document.getElementById('content-loading').classList.add('active');
            
            // ì½˜í…ì¸  ìƒì„± (ì‹¤ì œë¡œëŠ” APIì—ì„œ ë°›ì•„ì˜´)
            setTimeout(() => {
                const contentHtml = `
                    <div class="content-header">
                        <h2 class="content-title">${section.title}</h2>
                        <div class="content-actions">
                            <button class="btn btn-small btn-secondary" onclick="markAsCompleted('${section.section_id}')">
                                <i class="fas fa-check"></i> ì™„ë£Œ í‘œì‹œ
                            </button>
                        </div>
                    </div>
                    
                    <div class="content-card">
                        <h4><i class="fas fa-file-alt"></i> ìš”ì•½</h4>
                        <div class="summary-text">${sectionContent.summary || 'ìš”ì•½ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.'}</div>
                    </div>
                    
                    <div class="content-card">
                        <h4><i class="fas fa-tags"></i> í•µì‹¬ í‚¤ì›Œë“œ</h4>
                        <div class="keywords">
                            ${(sectionContent.keywords || []).map(keyword => 
                                `<span class="keyword-tag">${keyword}</span>`
                            ).join('')}
                        </div>
                    </div>
                    
                    <div class="content-card">
                        <h4><i class="fas fa-question-circle"></i> ì˜ˆìƒ ì§ˆë¬¸</h4>
                        <ul class="questions-list">
                            ${(sectionContent.questions || []).map((question, index) => 
                                `<li onclick="askQuestion('${question}')">
                                    <span class="question-number">Q${index + 1}.</span>
                                    ${question}
                                </li>`
                            ).join('')}
                        </ul>
                    </div>
                `;
                
                document.getElementById('content-section').innerHTML = contentHtml;
                document.getElementById('content-loading').classList.remove('active');
                document.getElementById('content-section').classList.add('active');
                
            }, 800);
        }

        // ì„¹ì…˜ ì™„ë£Œ í‘œì‹œ
        function markAsCompleted(sectionId) {
            const progressEl = document.getElementById(`progress-${sectionId}`);
            if (progressEl) {
                progressEl.classList.remove('current');
                progressEl.classList.add('completed');
                progressEl.innerHTML = '<i class="fas fa-check"></i>';
            }
            
            showMessage('ì„¹ì…˜ì„ ì™„ë£Œë¡œ í‘œì‹œí–ˆìŠµë‹ˆë‹¤!', 'success');
        }

        // ì±„íŒ… ì´ë²¤íŠ¸ ì„¤ì •
        function setupChatEvents() {
            const chatInput = document.getElementById('chat-input');
            const sendBtn = document.getElementById('chat-send-btn');
            
            chatInput.addEventListener('input', function() {
                sendBtn.disabled = !this.value.trim() || isTyping;
            });
            
            chatInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    if (!sendBtn.disabled) {
                        sendMessage();
                    }
                }
            });
            
            sendBtn.addEventListener('click', sendMessage);
        }

        // ì±„íŒ… í™œì„±í™”
        function enableChat() {
            const chatInput = document.getElementById('chat-input');
            chatInput.placeholder = `${currentDocument.filename}ì— ëŒ€í•´ ì§ˆë¬¸í•´ë³´ì„¸ìš”...`;
            chatInput.disabled = false;
        }

        // ì§ˆë¬¸ ì „ì†¡
        async function sendMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            
            if (!message || isTyping) return;
            
            // ì‚¬ìš©ì ë©”ì‹œì§€ í‘œì‹œ
            addChatMessage('user', message);
            input.value = '';
            document.getElementById('chat-send-btn').disabled = true;
            
            // AI ì‘ë‹µ ëŒ€ê¸°
            isTyping = true;
            addTypingIndicator();
            
            try {
                // API í˜¸ì¶œ (ë°°í¬í™˜ê²½ ëŒ€ì‘)
                const response = await fetch('/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        question: message,
                        document: currentDocument.filename
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                const aiResponse = data.answer;
                
                setTimeout(() => {
                    removeTypingIndicator();
                    addChatMessage('ai', aiResponse);
                    isTyping = false;
                    document.getElementById('chat-send-btn').disabled = false;
                }, 1500);
                
            } catch (error) {
                removeTypingIndicator();
                addChatMessage('ai', 'ì£„ì†¡í•©ë‹ˆë‹¤. ë‹µë³€ì„ ìƒì„±í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                isTyping = false;
                document.getElementById('chat-send-btn').disabled = false;
            }
        }

        // ì˜ˆìƒ ì§ˆë¬¸ í´ë¦­
        function askQuestion(question) {
            const input = document.getElementById('chat-input');
            input.value = question;
            input.focus();
            document.getElementById('chat-send-btn').disabled = false;
        }

        // ì±„íŒ… ë©”ì‹œì§€ ì¶”ê°€
        function addChatMessage(type, message) {
            const messagesContainer = document.getElementById('chat-messages');
            const messageEl = document.createElement('div');
            messageEl.className = `message ${type}`;
            
            const now = new Date();
            const timeStr = now.toLocaleTimeString('ko-KR', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            
            messageEl.innerHTML = `
                <div class="message-avatar">
                    <i class="fas fa-${type === 'user' ? 'user' : 'robot'}"></i>
                </div>
                <div class="message-content">
                    ${message}
                    <div class="message-time">${timeStr}</div>
                </div>
            `;
            
            messagesContainer.appendChild(messageEl);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // íƒ€ì´í•‘ í‘œì‹œ ì¶”ê°€
        function addTypingIndicator() {
            const messagesContainer = document.getElementById('chat-messages');
            const typingEl = document.createElement('div');
            typingEl.id = 'typing-indicator';
            typingEl.className = 'message ai';
            typingEl.innerHTML = `
                <div class="message-avatar">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="message-content">
                    <i class="fas fa-spinner fa-spin"></i> AIê°€ ë‹µë³€ì„ ìƒê°í•˜ê³  ìˆìŠµë‹ˆë‹¤...
                </div>
            `;
            
            messagesContainer.appendChild(typingEl);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // íƒ€ì´í•‘ í‘œì‹œ ì œê±°
        function removeTypingIndicator() {
            const typingEl = document.getElementById('typing-indicator');
            if (typingEl) {
                typingEl.remove();
            }
        }

        // AI ì‘ë‹µ ìƒì„± (ë”ë¯¸)
        async function generateAIResponse(question) {
            const responses = [
                'ì¢‹ì€ ì§ˆë¬¸ì´ë„¤ìš”! ë¬¸ì„œì— ë”°ë¥´ë©´...',
                'í•´ë‹¹ ë‚´ìš©ì— ëŒ€í•´ ì„¤ëª…ë“œë¦¬ê² ìŠµë‹ˆë‹¤.',
                'ë¬¸ì„œì˜ ê´€ë ¨ ë¶€ë¶„ì„ ì°¾ì•„ë³´ë‹ˆ...',
                'ì´ ì£¼ì œì— ëŒ€í•´ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì„¤ëª…ë˜ì–´ ìˆìŠµë‹ˆë‹¤.',
                'í¥ë¯¸ë¡œìš´ ì§ˆë¬¸ì…ë‹ˆë‹¤. ë¬¸ì„œì—ì„œëŠ”...'
            ];
            
            const randomResponse = responses[Math.floor(Math.random() * responses.length)];
            return randomResponse + ' (ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” AIê°€ ë¬¸ì„œ ë‚´ìš©ì„ ê¸°ë°˜ìœ¼ë¡œ ì •í™•í•œ ë‹µë³€ì„ ì œê³µí•©ë‹ˆë‹¤.)';
        }

        // í¬ê¸° ì¡°ì ˆ ë°” ì´ˆê¸°í™”
        function initResizer() {
            const resizer = document.getElementById('resizer');
            const contentArea = document.querySelector('.content-area');
            const chatArea = document.querySelector('.chat-area');
            const mainContent = document.querySelector('.main-content');
            
            let isResizing = false;
            let startX = 0;
            let startContentWidth = 0;
            let startChatWidth = 0;
            
            resizer.addEventListener('mousedown', function(e) {
                isResizing = true;
                startX = e.clientX;
                
                const contentRect = contentArea.getBoundingClientRect();
                const chatRect = chatArea.getBoundingClientRect();
                
                startContentWidth = contentRect.width;
                startChatWidth = chatRect.width;
                
                document.body.style.cursor = 'col-resize';
                document.body.style.userSelect = 'none';
                
                e.preventDefault();
            });
            
            document.addEventListener('mousemove', function(e) {
                if (!isResizing) return;
                
                const deltaX = e.clientX - startX;
                const mainContentWidth = mainContent.getBoundingClientRect().width - 8; // ë¦¬ì‚¬ì´ì € í­ ì œì™¸
                
                let newContentWidth = startContentWidth + deltaX;
                let newChatWidth = startChatWidth - deltaX;
                
                // ìµœì†Œ/ìµœëŒ€ í¬ê¸° ì œí•œ
                const minContentWidth = 300;
                const minChatWidth = 300;
                const maxChatWidth = 700;
                
                if (newContentWidth < minContentWidth) {
                    newContentWidth = minContentWidth;
                    newChatWidth = mainContentWidth - newContentWidth;
                }
                
                if (newChatWidth < minChatWidth) {
                    newChatWidth = minChatWidth;
                    newContentWidth = mainContentWidth - newChatWidth;
                }
                
                if (newChatWidth > maxChatWidth) {
                    newChatWidth = maxChatWidth;
                    newContentWidth = mainContentWidth - newChatWidth;
                }
                
                // ìŠ¤íƒ€ì¼ ì ìš©
                contentArea.style.width = newContentWidth + 'px';
                chatArea.style.width = newChatWidth + 'px';
                contentArea.style.flex = 'none';
                chatArea.style.flex = 'none';
                
                e.preventDefault();
            });
            
            document.addEventListener('mouseup', function() {
                if (isResizing) {
                    isResizing = false;
                    document.body.style.cursor = '';
                    document.body.style.userSelect = '';
                }
            });
        }

        // ì¸í„°í˜ì´ìŠ¤ ì´ˆê¸°í™”
        function resetStudyInterface() {
            currentDocument = null;
            currentCurriculum = null;
            currentSection = null;
            
            document.getElementById('document-info').style.display = 'none';
            document.getElementById('curriculum-tree-content').innerHTML = `
                <div class="empty-content">
                    <i class="fas fa-book-open"></i>
                    <p>ë¬¸ì„œë¥¼ ì„ íƒí•˜ë©´<br>ì»¤ë¦¬í˜ëŸ¼ì´ í‘œì‹œë©ë‹ˆë‹¤</p>
                </div>
            `;
            
            document.querySelectorAll('.section-content').forEach(el => {
                el.classList.remove('active');
            });
            document.getElementById('content-welcome').classList.add('active');
            
            const chatInput = document.getElementById('chat-input');
            chatInput.placeholder = 'ë¬¸ì„œë¥¼ ì„ íƒí•œ í›„ ì§ˆë¬¸í•´ë³´ì„¸ìš”...';
            chatInput.disabled = true;
        }

        // í™˜ì˜ ë©”ì‹œì§€ ì‹œê°„ ì„¤ì •
        function setWelcomeTime() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('ko-KR', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            document.getElementById('welcome-time').textContent = timeStr;
        }

        // ì»¤ë¦¬í˜ëŸ¼ ì˜¤ë¥˜ í‘œì‹œ
        function showCurriculumError() {
            document.getElementById('curriculum-tree-content').innerHTML = `
                <div class="empty-content">
                    <i class="fas fa-exclamation-triangle"></i>
                    <p>ì»¤ë¦¬í˜ëŸ¼ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë°<br>ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤</p>
                    <button class="btn btn-small btn-primary" onclick="loadCurriculum(currentDocument.filename)">
                        ë‹¤ì‹œ ì‹œë„
                    </button>
                </div>
            `;
        }
    </script>
</body>
</html>
